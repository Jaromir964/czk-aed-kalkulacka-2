<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CZK → AED PRO</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
font-family:-apple-system;
background:#f5f7fa;
margin:0;
padding:20px;
}
.card{
max-width:900px;
margin:auto;
background:#fff;
padding:30px;
border-radius:18px;
box-shadow:0 15px 40px rgba(0,0,0,.08);
}
h1{text-align:center}

.rate{text-align:center;margin:10px 0;font-weight:600;font-size:18px;}

.stats{
display:flex;
justify-content:space-around;
margin:15px 0;
font-weight:600;
}

.stat-box{
text-align:center;
}

input{
width:100%;
padding:12px;
font-size:18px;
border-radius:10px;
border:1px solid #ddd;
margin-bottom:10px;
}

.result{
text-align:center;
font-size:22px;
font-weight:bold;
margin-bottom:20px;
}

.buttons{display:flex;margin-bottom:10px}

button{
flex:1;
margin:5px;
padding:10px;
border:none;
border-radius:8px;
background:#e9eef5;
cursor:pointer;
}

button.active{
background:#007aff;
color:white;
}

canvas{margin-top:10px}
</style>
</head>

<body>

<div class="card">
<h1>CZK → AED</h1>

<div class="rate" id="rate">Načítá se kurz...</div>

<div class="stats">
<div class="stat-box">Změna: <div id="change">-</div></div>
<div class="stat-box">Min: <div id="min">-</div></div>
<div class="stat-box">Max: <div id="max">-</div></div>
</div>

<input type="number" id="amount" value="1000">
<div class="result" id="result"></div>

<div class="buttons">
<button onclick="loadHistory(7,this)" class="active">7 dní</button>
<button onclick="loadHistory(30,this)">30 dní</button>
<button onclick="loadHistory(90,this)">90 dní</button>
</div>

<canvas id="chart"></canvas>
</div>

<script>

let chart;
let selectedDays = 7;
let fullData = {};
let currentRate = 0;
const API_KEY = "QE7EVYZZBM5J6VUR";

async function fetchFullHistory(){
const url = `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=CZK&to_symbol=AED&outputsize=full&apikey=${API_KEY}`;
const res = await fetch(url);
const data = await res.json();
fullData = data["Time Series FX (Daily)"];
updateCurrentRate();
loadHistory(selectedDays, document.querySelector(".active"));
}

function updateCurrentRate(){
const dates = Object.keys(fullData).sort();
const latestDate = dates[dates.length - 1];
currentRate = parseFloat(fullData[latestDate]["4. close"]);
document.getElementById("rate").innerText =
"Aktuální kurz: 1 CZK = " + currentRate.toFixed(4) + " AED";
calculate();
}

function calculate(){
const amount = document.getElementById("amount").value;
document.getElementById("result").innerText =
(amount * currentRate).toFixed(4) + " AED";
}

function loadHistory(days,btn){

selectedDays = days;
document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
btn.classList.add("active");

const dates = Object.keys(fullData).sort().slice(-days);
const values = dates.map(date => parseFloat(fullData[date]["4. close"]));

const first = values[0];
const last = values[values.length-1];
const min = Math.min(...values);
const max = Math.max(...values);
const change = ((last-first)/first*100).toFixed(2);

document.getElementById("change").innerText = change + " %";
document.getElementById("min").innerText = min.toFixed(4);
document.getElementById("max").innerText = max.toFixed(4);

if(chart) chart.destroy();

chart = new Chart(document.getElementById("chart"), {
type: "line",
data: {
labels: dates,
datasets: [{
data: values,
tension: 0.3,
pointRadius: 2,
fill: false
}]
},
options: {
responsive: true,
interaction: { mode: 'index', intersect: false },
plugins: { legend: { display: false } },
scales: {
x: { grid: { display: false } },
y: { grid: { color: "#eee" } }
}
}
});
}

document.getElementById("amount").addEventListener("input", calculate);
fetchFullHistory();

</script>

</body>
</html>
